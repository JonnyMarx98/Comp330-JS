<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>JonnyIsGud</title>
    <script src="bullet.js"></script>
    <script src="input.js"></script>
</head>
<canvas id="gameCanvas" width="1200" height="900"></canvas>

</html>

<script>

    class enemy {
        Spawn(x,y) {
            this.enemyX = 0;
            this.enemyY = 0;

            this.enemyX = x;
            this.enemyY = y;
            this.enemySpeed = Math.floor((Math.random() * 5) + 1);
        }
        Update() {
            if(this.enemyY < playerY) {
                this.enemyY = this.enemyY + this.enemySpeed;
            }
            if(this.enemyY > playerY) {
                this.enemyY = this.enemyY - this.enemySpeed;
            }
            if(this.enemyX < playerX) {
                this.enemyX = this.enemyX + this.enemySpeed;
            }
            if(this.enemyX > playerX) {
                this.enemyX = this.enemyX - this.enemySpeed;
            }
            enemyDelayTimer -= 1;
        }
        Draw() {
            colourRect(this.enemyX,this.enemyY,ENEMY_WIDTH,ENEMY_HEIGHT,'red');
        }
        CheckCollision() {
            if(playerX + PLAYER_WIDTH > this.enemyX &&
                playerX - PLAYER_WIDTH < this.enemyX &&
                playerY - PLAYER_HEIGHT < this.enemyY &&
                playerY + PLAYER_HEIGHT > this.enemyY) {
                resetPlayer();
                this.Reset();
            }
        }
        Clamp() {
            if (this.enemyY + ENEMY_HEIGHT > canvas.height){
                this.enemyY = canvas.height - ENEMY_HEIGHT;
            }
            if (this.enemyY < 100) {
                this.enemyY = 100;
            }
            if (this.enemyX + ENEMY_WIDTH > canvas.width) {
                this.enemyX = canvas.width - ENEMY_WIDTH;
            }
            if (this.enemyX < 0) {
                this.enemyX = 0;
            }
        }
        Reset(){
            this.enemyX = canvas.width;
            this.enemyY = Math.floor((Math.random() * canvas.height) + 1);
            //enemySpeed = 1;
        }
    }

    var canvas;
    var canvasContext;
    var gravity = 5;

    // Enemy vars
    const ENEMY_WIDTH = 50;
    const ENEMY_HEIGHT = 50;
    const ENEMY_DELAY = 60;
    var enemyX = 600;
    var enemyY = 500;
    var enemySpeed = 2;
    var enemies = [];
    var newEnemy = new enemy();
    var enemyDelayTimer = ENEMY_DELAY;

    // Player vars
    const PLAYER_WIDTH = 50;
    const PLAYER_HEIGHT = 50;
    var playerX = 50;
    var playerY = 50;

    // Bullet vars
    const BULLET_WIDTH = 25;
    const BULLET_HEIGHT = 25;
    const BULLET_DELAY = 10;
    const BULLET_SPEED = 20;
    var i;
    var bulletX = 5000;
    var bulletY = 5000;
    var bulletDelayTimer = BULLET_DELAY;
    var bullets = [];
    var NUMBER_OF_BULLETS = 1;
    var newBullet = new bullet;

    // Keys
    var keyW = false;
    var keyA = false;
    var keyS = false;
    var keyD = false;
    var keySpace = false;
    var keyRight = false;

    var timer = 0;
    var score = 0;
    var score2 = 0;


    var PlayerSpeed = 5;

    window.addEventListener("keydown", keyDownHandler, false);
    window.addEventListener("keyup", keyUpHandler, false);

    function keyDownHandler(e) {
        if(e.keyCode == 68) {
            keyD = true;
        }
        if(e.keyCode == 83) {
            keyS = true;
        }
        if(e.keyCode == 65) {
            keyA = true;
        }
        if(e.keyCode == 87) {
            keyW = true;
        }
        if(e.keyCode == 32) {
            keySpace = true;
        }
        if(e.keyCode == 39) {
            keyRight = true;
        }

    }
    function keyUpHandler(e) {
        if(e.keyCode == 68) {
            keyD = false;
        }
        if(e.keyCode == 83) {
            keyS = false;
        }
        if(e.keyCode == 65) {
            keyA = false;
        }
        if(e.keyCode == 87) {
            keyW = false;
        }
        if(e.keyCode == 32) {
            keySpace = false;
        }
        if(e.keyCode == 39) {
            keyRight = false;
        }
    }

    function handleMouseClick(evt) {
    }

    window.onload = function() {
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');

        var framesPerSecond = 60;
        setInterval(function() {
            moveEverything();
            drawEverything();
        }, 1000/framesPerSecond);

        canvas.addEventListener('mousedown', handleMouseClick);
    }

    function computerMovement() {
        // if(enemyY < playerY) {
        //     enemyY = enemyY + enemySpeed;
        // }
        // if(enemyY > playerY) {
        //     enemyY = enemyY - enemySpeed;
        // }
        // if(enemyX < playerX) {
        //     enemyX = enemyX + enemySpeed;
        // }
        // if(enemyX > playerX) {
        //     enemyX = enemyX - enemySpeed;
        // }

    }

    function Gravity(){
        playerY += gravity;
        enemyY += gravity;
    }

    function resetPlayer() {
        playerX = 0;
        playerY = 0;
        timer = 0;

    }

    function resetEnemy() {
        // enemyX = canvas.width;
        // enemyY = canvas.height;
        // enemySpeed = 1;

    }

    function moveEverything() {
        //Gravity();

        timer += 1/60;
        bulletDelayTimer--;
        enemyDelayTimer--;

        for (i = 0; i<bullets.length; i++) {
            bullets[i].CheckCollision(enemies);
        }

        ClampEverything();

        for (i=0; i<enemies.length; i++){
            enemies[i].CheckCollision();
            enemies[i].Update();
        }

        // KEY SPACE HERE
        if (keySpace) {
            if (bulletDelayTimer < 0) {
                bulletDelayTimer = BULLET_DELAY;
                newBullet = new bullet();
                newBullet.Spawn(playerX + PLAYER_WIDTH/4, playerY + PLAYER_HEIGHT/4);
                bullets.push(newBullet);
            }
        }

        if (keyRight) {
            if (enemyDelayTimer < 0) {
                enemyDelayTimer = ENEMY_DELAY;
                newEnemy = new enemy();
                newEnemy.Spawn(canvas.width, Math.floor((Math.random() * canvas.height) + 1));
                enemies.push(newEnemy);
            }
        }


        for (i = 0; i<bullets.length; i++) {
            bullets[i].Update();
        }
        //bulletX += 20;

        if(keyD){
            playerX += PlayerSpeed;
        }
        if(keyA) {
            playerX -= PlayerSpeed;
        }
        if(keyS) {
            playerY += PlayerSpeed;
        }
        if(keyW) {
            playerY -= PlayerSpeed;
        }
    }

    function drawEverything() {


        // next line blanks out the screen with grey
        colourRect(0,0,canvas.width,canvas.height,'#e6b800');
        // top bar
        colourRect(0,0,canvas.width,100,'grey');

        // this is the player
        colourRect(playerX,playerY,PLAYER_WIDTH,PLAYER_HEIGHT,'#e6e6e6');
        // this is the enemy
        //colourRect(enemyX,enemyY,ENEMY_WIDTH,ENEMY_HEIGHT,'red');
        for (i = 0; i<enemies.length; i++) {
            enemies[i].Draw();
        }
        // bullet
        for (i = 0; i<bullets.length; i++) {
            bullets[i].Draw();
        }
        displayText("Time: " + timer.toFixed(2), 150, 75, "red");
        displayText("Score: " + score.toFixed(0), 1000, 75, "red");

    }

    function displayText(text, x, y, colour) {
        canvasContext.font="60px Arial";
        canvasContext.font = "30px Comic Sans MS";
        canvasContext.fillStyle = colour;
        //canvasContext.textAlign = "center";
        canvasContext.fillText(text, x, y);

    }

    function ClampEverything(){
        if (playerY + PLAYER_HEIGHT > canvas.height){
            playerY = canvas.height - PLAYER_HEIGHT;
        }
        if (playerY < 100) {
            playerY = 100;
        }
        if (playerX + PLAYER_WIDTH > canvas.width) {
            playerX = canvas.width - PLAYER_WIDTH;
        }
        if (playerX < 0) {
            playerX = 0;
        }

        for (i = 0; i<enemies.length; i++) {
            enemies[i].Clamp();
        }



        // if (enemyY + ENEMY_HEIGHT > canvas.height){
        //     enemyY = canvas.height - ENEMY_HEIGHT;
        // }
        // if (enemyY < 100) {
        //     enemyY = 100;
        // }
        // if (enemyX + ENEMY_WIDTH > canvas.width) {
        //     enemyX = canvas.width - ENEMY_WIDTH;
        // }
        // if (enemyX < 0) {
        //     enemyX = 0;
        // }
    }

    function colourRect(leftX,topY, width,height, drawColor) {
        canvasContext.fillStyle = drawColor;
        canvasContext.fillRect(leftX,topY, width,height);
    }



    // Bullet = function () {
    //     this.
    //
    // }

    // function spawnProjectile() {
    //     // spawns bullet and adds it to array
    //     var newBullet = new bullet();
    //     newBullet.init();
    //     bullets.push(newBullet);
    //
    //     // projectile
    //     colourRect(10, 10, 10, 10, 'red');
    //
    // }
</script>

